<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Checkout Produk</title>
  <link rel="icon" type="image/png" href="https://files.catbox.moe/nbsldh.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f9f9f9;
    }
    .container {
      background: white;
      max-width: 500px;
      margin: auto;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .slider-wrapper {
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    .slider-container {
      display: flex;
      transition: transform 0.3s ease-in-out;
    }
    .slider-container img {
      width: 100%;
      flex-shrink: 0;
      cursor: zoom-in;
    }
    .slider-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      border: none;
      color: white;
      font-size: 20px;
      padding: 10px;
      cursor: pointer;
      z-index: 1;
    }
    .slider-button.left { left: 10px; }
    .slider-button.right { right: 10px; }

    .dots {
      text-align: center;
      margin-top: 10px;
    }
    .dot {
      display: inline-block;
      height: 12px;
      width: 12px;
      margin: 0 4px;
      background-color: #ccc;
      border-radius: 50%;
      cursor: pointer;
    }
    .dot.active {
      background-color: #28a745;
    }

    .form-group { margin-bottom: 15px; }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }
    input[type="text"], select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button, .home-button {
      width: 100%;
      padding: 12px;
      background-color: #28a745;
      border: none;
      color: white;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover, .home-button:hover {
      background-color: #218838;
    }
    .payment-icons {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-top: 8px;
    }
    .payment-icons img {
      height: 45px;
      background: white;
      border-radius: 8px;
      padding: 4px;
      border: 1px solid #ddd;
    }
    .order-summary {
      margin-top: 20px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
    .summary-table {
      width: 100%;
      border-collapse: collapse;
    }
    .summary-table td {
      padding: 8px 0;
    }
    .total-row td {
      border-top: 2px solid #000;
      font-weight: bold;
    }
    .quantity-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .quantity-group button {
      width: 40px;
      padding: 8px;
      font-size: 18px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
    }
    .modal img {
      max-width: 90%;
      margin: 20px auto;
      display: block;
      border-radius: 12px;
    }
    .modal .close {
      position: absolute;
      top: 15px;
      right: 25px;
      color: white;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
    }
    .confirm-content {
      background: white;
      margin: 10% auto;
      padding: 20px;
      max-width: 400px;
      border-radius: 10px;
    }
    .confirm-content table {
      width: 100%;
      margin-bottom: 20px;
    }
    .confirm-content td {
      padding: 6px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Checkout Produk</h2>
    <div class="form-group">
      <label>Klik Gambar Untuk Melihat</label>
      <div class="slider-wrapper">
        <div class="slider-container" id="sliderContainer"></div>
        <button class="slider-button left" onclick="showSlide(currentIndex - 1)">❮</button>
        <button class="slider-button right" onclick="showSlide(currentIndex + 1)">❯</button>
      </div>
      <div class="dots" id="sliderDots"></div>
    </div>

    <div class="form-group">
      <label>Deskripsi Produk</label>
      <p id="deskripsi-produk" style="background: #f1f1f1; padding: 10px; border-radius: 6px;"></p>
    </div>

    <form id="checkoutForm">
      <div class="form-group">
        <label for="produk">Produk</label>
        <input type="text" id="produk" name="produk" readonly />
      </div>
      <div class="form-group">
        <label>Jumlah Barang</label>
        <div class="quantity-group">
          <button type="button" id="kurang">-</button>
          <input type="text" id="jumlah" name="jumlah" value="1" readonly style="text-align:center; width:50px;" />
          <button type="button" id="tambah">+</button>
        </div>
      </div>
      <div class="form-group">
        <label for="harga">Harga</label>
        <input type="text" id="harga" name="harga" readonly />
      </div>
      <div class="form-group">
        <label for="metode">Metode Pembayaran</label>
        <select id="metode" name="metode" required>
          <option value="">Pilih Metode</option>
          <option value="DANA">DANA</option>
          <option value="OVO">OVO</option>
          <option value="GoPay">GoPay</option>
          <option value="QRIS">QRIS</option>
        </select>
        <div class="payment-icons">
          <img src="https://i.imgur.com/jyUJkaa.jpeg" alt="DANA" />
          <img src="https://i.imgur.com/eyKiIrk.jpeg" alt="OVO" />
          <img src="https://i.imgur.com/2bUZpBK.jpeg" alt="GoPay" />
          <img src="https://i.imgur.com/WXDsDdx.jpeg" alt="QRIS" style="height: 40px;" />
        </div>
      </div>
      <div class="form-group">
        <label for="nama">Nama Pembeli</label>
        <input type="text" id="nama" name="nama" placeholder="Masukkan nama Anda" required />
      </div>
      <div class="form-group">
        <label for="wa">Nomor WhatsApp</label>
        <input type="text" id="wa" name="wa" placeholder="08xxxxxxxxxx" required />
      </div>
      <div class="order-summary">
        <table class="summary-table">
          <tr><td>Subtotal</td><td id="subtotal">Rp0</td></tr>
          <tr><td>Pajak (0.5%)</td><td id="pajak">Rp0</td></tr>
          <tr class="total-row"><td>Total</td><td id="total">Rp0</td></tr>
        </table>
      </div>
      <button type="submit">Kirim Pesanan via WhatsApp</button>
    </form>
    <a href="index.html"><button class="home-button">Kembali ke Beranda</button></a>
  </div>

  <div id="imageModal" class="modal">
    <span class="close" onclick="document.getElementById('imageModal').style.display='none'">&times;</span>
    <div id="modalGallery"></div>
  </div>

  <div id="confirmModal" class="modal">
    <div class="confirm-content">
      <h3>Konfirmasi Pesanan</h3>
      <table>
        <tr><td>Produk</td><td id="c-produk"></td></tr>
        <tr><td>Jumlah</td><td id="c-jumlah"></td></tr>
        <tr><td>Total</td><td id="c-total"></td></tr>
        <tr><td>Nama</td><td id="c-nama"></td></tr>
        <tr><td>WhatsApp</td><td id="c-wa"></td></tr>
        <tr><td>Pembayaran</td><td id="c-metode"></td></tr>
      </table>
      <button id="lanjutBtn">Confirm</button>
      <button onclick="document.getElementById('confirmModal').style.display='none'">Batal</button>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const produk = params.get("produk") || "Produk Tidak Diketahui";
    const hargaProduk = parseInt(params.get("harga") || "0");
    const deskripsi = params.get("deskripsi") || "Deskripsi tidak tersedia.";
    const spekGambar = [];
    for (let i = 1; i <= 5; i++) {
      const g = params.get("gambar" + i);
      if (g) spekGambar.push(g);
    }

    let jumlah = 1;
    let currentIndex = 0;
    const pajakPersen = 0.005;

    const pajak = () => Math.round((hargaProduk * jumlah) * pajakPersen);
    const total = () => (hargaProduk * jumlah + pajak());
    const updateHarga = () => {
      document.getElementById("subtotal").textContent = "Rp" + (hargaProduk * jumlah).toLocaleString();
      document.getElementById("pajak").textContent = "Rp" + pajak().toLocaleString();
      document.getElementById("total").textContent = "Rp" + total().toLocaleString();
    };

    document.getElementById("produk").value = produk;
    document.getElementById("harga").value = "Rp" + hargaProduk.toLocaleString();
    document.getElementById("deskripsi-produk").textContent = deskripsi;
    updateHarga();

    document.getElementById("tambah").onclick = () => { jumlah++; document.getElementById("jumlah").value = jumlah; updateHarga(); };
    document.getElementById("kurang").onclick = () => { if (jumlah > 1) { jumlah--; document.getElementById("jumlah").value = jumlah; updateHarga(); } };

    const sliderContainer = document.getElementById("sliderContainer");
    const dotsContainer = document.getElementById("sliderDots");

    spekGambar.forEach((src, index) => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = "Gambar Produk";
      img.addEventListener('click', () => {
        const modal = document.getElementById("imageModal");
        const gallery = document.getElementById("modalGallery");
        gallery.innerHTML = `<img src="${src}" alt="Preview">`;
        modal.style.display = "block";
      });
      sliderContainer.appendChild(img);

      const dot = document.createElement('span');
      dot.classList.add('dot');
      dot.addEventListener('click', () => showSlide(index));
      dotsContainer.appendChild(dot);
    });

    function showSlide(index) {
      const max = spekGambar.length - 1;
      currentIndex = Math.max(0, Math.min(index, max));
      sliderContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
      document.querySelectorAll('.dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === currentIndex);
      });
    }
    showSlide(0);

    function getTransferInfo(metode) {
      switch (metode) {
        case "DANA": case "OVO": case "GoPay": return "081234567890 a.n. Admin";
        case "QRIS": return "https://link.com/qris";
        default: return "-";
      }
    }

    document.getElementById("checkoutForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const nama = document.getElementById("nama").value;
      const wa = document.getElementById("wa").value;
      const metode = document.getElementById("metode").value;

      document.getElementById("c-produk").textContent = produk;
      document.getElementById("c-jumlah").textContent = jumlah + " pcs";
      document.getElementById("c-total").textContent = "Rp" + total().toLocaleString();
      document.getElementById("c-nama").textContent = nama;
      document.getElementById("c-wa").textContent = wa;
      document.getElementById("c-metode").textContent = metode;

      document.getElementById("confirmModal").style.display = "block";

      document.getElementById("lanjutBtn").onclick = () => {
        const message = `*📦 Formulir Checkout 📦*%0A` +
        `==============================%0A` +
        `Produk              : ${produk}%0A` +
        `Jumlah              : ${jumlah} pcs%0A` +
        `Harga Satuan  : Rp${hargaProduk.toLocaleString()}%0A` +
        `Subtotal           : Rp${(hargaProduk * jumlah).toLocaleString()}%0A` +
        `Pajak (0.5%)    : Rp${pajak().toLocaleString()}%0A` +
        `Total                 : Rp${total().toLocaleString()}%0A` +
        `==============================%0A` +
        `Nama                : ${nama}%0A` +
        `WhatsApp         : ${wa}%0A` +
        `Metode Bayar  : ${metode}%0A` +
        `Transfer ke       : ${getTransferInfo(metode)}`;

        const phoneNumber = "6283171080910";
        const waURL = `https://wa.me/${phoneNumber}?text=${message}`;
        window.open(waURL, "_blank");
        document.getElementById("confirmModal").style.display = "none";
      };
    });
  </script>
</body>
</html>